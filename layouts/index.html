{{ define "main" }}

{{ partial "hero.html" . }}

<div class="container">
  <div class="section__info">
    <div class="section__head">
      <h2 class="section__title">{{ .Site.Params.blog.blog__title | safeHTML }}</h2>
      {{ if .Site.Params.blog.blog__description }}
        <p class="section__description">{{ .Site.Params.blog.blog__description }}</p>
      {{ end }}
    </div>
  </div>

  <div class="row grid">

    {{ $allNonExcludedPages := where .Site.RegularPages "Params.excludefromindex" "==" nil }}
    {{ $allNonExcludedPagesNotTypePage := (where .Site.RegularPages "Type" "ne" "page" | intersect $allNonExcludedPages) }}

    {{ $featuredPosts :=  (where (where .Site.RegularPages "Type" "in" site.Params.mainSections) ".Params.featured" "=" true)    }}
    {{ $featuredPostRelPermalinks := $featuredPosts }}

    {{ $pagesToPaginate := where $allNonExcludedPagesNotTypePage "RelPermalink" "not in" $featuredPostRelPermalinks }}

    {{ $paginationLimit := index .Site.Params "paginate" | default 7 }}
    {{ $paginator := .Paginate $pagesToPaginate $paginationLimit }}


    <!-- {{ $paginator := .Paginate (where .Site.RegularPages "Type" "posts") }}
    {{ range $paginator.Pages }}
      {{ partial "article.html" . }}
    {{ end }} -->

    <!-- {{ $paginator := .Paginate (where .Data.Pages "Type" "ne" "page") (index .Site.Params "paginate" | default 7) }} -->

    {{ range  where .Paginator.Pages "Type" "ne" "page" }} 
    
            {{  if fileExists (print "layouts/partials/content-type/" .Type ".html")  }}
                {{ partial (print "content-type/" .Type ".html") (dict "ctx" . "template_type" "multiple") }}
            {{ else }}
                {{ partial "content-type/article.html" (dict "ctx" . "template_type" "multiple") }}
            {{ end }}

    {{ end }}

  </div>
</div>

{{ partial "pagination.html" . }}

{{ partial "tags-section.html" . }}

{{ end }}